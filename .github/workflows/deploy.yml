name: Deploy to Netlify

on:
  push:
    branches: [master]

jobs:
  trigger-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Netlify deploy with commit message
        env:
          COMMIT_MSG: ${{ github.event.head_commit.message }}
          HOOK_URL: ${{ secrets.NETLIFY_BUILD_HOOK }}
        run: |
          # Use jq to safely build JSON with the commit message
          PAYLOAD=$(jq -n --arg title "$COMMIT_MSG" '{"title": $title}')
          curl -s -X POST \
            -H "Content-Type: application/json" \
            -d "$PAYLOAD" \
            "$HOOK_URL"
