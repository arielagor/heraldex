name: Deploy to Netlify

on:
  push:
    branches: [master]

jobs:
  trigger-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Netlify deploy with commit message
        env:
          COMMIT_MSG: ${{ github.event.head_commit.message }}
          HOOK_URL: ${{ secrets.NETLIFY_BUILD_HOOK }}
        run: |
          # URL-encode the first line of the commit message for trigger_title
          FIRST_LINE=$(echo "$COMMIT_MSG" | head -n 1)
          ENCODED=$(python3 -c "import urllib.parse, sys; print(urllib.parse.quote(sys.argv[1]))" "$FIRST_LINE")
          curl -s -X POST -d '{}' "${HOOK_URL}?trigger_title=${ENCODED}"
